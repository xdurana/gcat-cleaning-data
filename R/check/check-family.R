library(tidyverse)
library(plyr)

directory <- 'family'

ds <- gcat %>%
  select(
    entity_id,
    ADOPTADO,
    PARTO_MULTIPLE,
    FAMILIA_PADRE_ENFERMEDADES_CANCER,
    FAMILIA_PADRE_ENFERMEDADES_DIABETES,
    FAMILIA_PADRE_ENFERMEDADES_HTA,
    FAMILIA_PADRE_ENFERMEDADES_HIPERCOLESTEROLEMIA,
    FAMILIA_PADRE_ENFERMEDADES_ICTUS,
    FAMILIA_PADRE_ENFERMEDADES_INFARTO,
    FAMILIA_PADRE_ENFERMEDADES_ANGINA,
    FAMILIA_PADRE_ENFERMEDADES_HELICOBACTER,
    FAMILIA_PADRE_ENFERMEDADES_CROHN,
    FAMILIA_PADRE_ENFERMEDADES_COLITIS,
    FAMILIA_PADRE_ENFERMEDADES_POLIPOS,
    FAMILIA_PADRE_ENFERMEDADES_HEPATITIS,
    FAMILIA_PADRE_ENFERMEDADES_ALERGIA,
    FAMILIA_PADRE_ENFERMEDADES_RINITIS,
    FAMILIA_PADRE_ENFERMEDADES_ECZEMA,
    FAMILIA_PADRE_ENFERMEDADES_PSORIASIS,
    FAMILIA_PADRE_ENFERMEDADES_ARTRITIS,
    FAMILIA_PADRE_ENFERMEDADES_LUPUS,
    FAMILIA_PADRE_ENFERMEDADES_EPOC,
    FAMILIA_PADRE_ENFERMEDADES_ASMA,
    FAMILIA_PADRE_ENFERMEDADES_OSTEOPOROSIS,
    FAMILIA_PADRE_ENFERMEDADES_DEPRESION,
    FAMILIA_PADRE_ENFERMEDADES_MIGRANA,
    FAMILIA_PADRE_ENFERMEDADES_ESQUIZOFRENIA,
    FAMILIA_PADRE_ENFERMEDADES_ALZHEIMER,
    FAMILIA_PADRE_ENFERMEDADES_PARKINSON,
    FAMILIA_PADRE_ENFERMEDADES_GENETICA_HEREDITARIA,
    FAMILIA_MADRE_ENFERMEDADES_CANCER,
    FAMILIA_MADRE_ENFERMEDADES_DIABETES,
    FAMILIA_MADRE_ENFERMEDADES_HTA,
    FAMILIA_MADRE_ENFERMEDADES_HIPERCOLESTEROLEMIA,
    FAMILIA_MADRE_ENFERMEDADES_ICTUS,
    FAMILIA_MADRE_ENFERMEDADES_INFARTO,
    FAMILIA_MADRE_ENFERMEDADES_ANGINA,
    FAMILIA_MADRE_ENFERMEDADES_HELICOBACTER,
    FAMILIA_MADRE_ENFERMEDADES_CROHN,
    FAMILIA_MADRE_ENFERMEDADES_COLITIS,
    FAMILIA_MADRE_ENFERMEDADES_POLIPOS,
    FAMILIA_MADRE_ENFERMEDADES_HEPATITIS,
    FAMILIA_MADRE_ENFERMEDADES_ALERGIA,
    FAMILIA_MADRE_ENFERMEDADES_RINITIS,
    FAMILIA_MADRE_ENFERMEDADES_ECZEMA,
    FAMILIA_MADRE_ENFERMEDADES_PSORIASIS,
    FAMILIA_MADRE_ENFERMEDADES_ARTRITIS,
    FAMILIA_MADRE_ENFERMEDADES_LUPUS,
    FAMILIA_MADRE_ENFERMEDADES_EPOC,
    FAMILIA_MADRE_ENFERMEDADES_ASMA,
    FAMILIA_MADRE_ENFERMEDADES_OSTEOPOROSIS,
    FAMILIA_MADRE_ENFERMEDADES_DEPRESION,
    FAMILIA_MADRE_ENFERMEDADES_MIGRANA,
    FAMILIA_MADRE_ENFERMEDADES_ESQUIZOFRENIA,
    FAMILIA_MADRE_ENFERMEDADES_ALZHEIMER,
    FAMILIA_MADRE_ENFERMEDADES_PARKINSON,
    FAMILIA_MADRE_ENFERMEDADES_GENETICA_HEREDITARIA
  )

ds <- ds %>%
  mutate(
    adopted = ifelse(is.na(ADOPTADO), NA, ifelse(ADOPTADO == "NO", FALSE, TRUE)),
    multiple_birth = ifelse(is.na(PARTO_MULTIPLE), NA, ifelse(PARTO_MULTIPLE == "NO", FALSE, TRUE))
  ) %>%
  mutate(
    family_history_icd9_code3_199 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_CANCER == "true" | FAMILIA_MADRE_ENFERMEDADES_CANCER == "true"),
    family_history_icd9_code3_250 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_DIABETES == "true" | FAMILIA_MADRE_ENFERMEDADES_DIABETES == "true"),
    family_history_icd9_code3_401 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_HTA == "true" | FAMILIA_MADRE_ENFERMEDADES_HTA == "true"),
    family_history_icd9_code3_272 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_HIPERCOLESTEROLEMIA == "true" | FAMILIA_MADRE_ENFERMEDADES_HIPERCOLESTEROLEMIA == "true"),
    family_history_icd9_code3_414 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ICTUS == "true" | FAMILIA_MADRE_ENFERMEDADES_ICTUS == "true"),
    family_history_icd9_code3_410 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_INFARTO == "true" | FAMILIA_MADRE_ENFERMEDADES_INFARTO == "true"),
    family_history_icd9_code3_410 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ANGINA == "true" | FAMILIA_MADRE_ENFERMEDADES_ANGINA == "true"),
    family_history_icd9_code3_041 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_HELICOBACTER == "true" | FAMILIA_MADRE_ENFERMEDADES_HELICOBACTER == "true"),
    family_history_icd9_code3_555 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_CROHN == "true" | FAMILIA_MADRE_ENFERMEDADES_CROHN == "true"),
    family_history_icd9_code3_558 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_COLITIS == "true" | FAMILIA_MADRE_ENFERMEDADES_COLITIS == "true"),
    family_history_icd9_code3_569 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_POLIPOS == "true" | FAMILIA_MADRE_ENFERMEDADES_POLIPOS == "true"),
    family_history_icd9_code3_571 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_HEPATITIS == "true" | FAMILIA_MADRE_ENFERMEDADES_HEPATITIS == "true"),
    family_history_icd9_code3_995 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ALERGIA == "true" | FAMILIA_MADRE_ENFERMEDADES_ALERGIA == "true"),
    family_history_icd9_code3_472 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_RINITIS == "true" | FAMILIA_MADRE_ENFERMEDADES_RINITIS == "true"),
    family_history_icd9_code3_692 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ECZEMA == "true" | FAMILIA_MADRE_ENFERMEDADES_ECZEMA == "true"),
    family_history_icd9_code3_696 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_PSORIASIS == "true" | FAMILIA_MADRE_ENFERMEDADES_PSORIASIS == "true"),
    family_history_icd9_code3_714 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ARTRITIS == "true" | FAMILIA_MADRE_ENFERMEDADES_ARTRITIS == "true"),
    family_history_icd9_code3_710 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_LUPUS == "true" | FAMILIA_MADRE_ENFERMEDADES_LUPUS == "true"),
    family_history_icd9_code3_496 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_EPOC == "true" | FAMILIA_MADRE_ENFERMEDADES_EPOC == "true"),
    family_history_icd9_code3_493 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ASMA == "true" | FAMILIA_MADRE_ENFERMEDADES_ASMA == "true"),
    family_history_icd9_code3_733 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_OSTEOPOROSIS == "true" | FAMILIA_MADRE_ENFERMEDADES_OSTEOPOROSIS == "true"),
    family_history_icd9_code3_311 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_DEPRESION == "true" | FAMILIA_MADRE_ENFERMEDADES_DEPRESION == "true"),
    family_history_icd9_code3_346 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_MIGRANA == "true" | FAMILIA_MADRE_ENFERMEDADES_MIGRANA == "true"),
    family_history_icd9_code3_295 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ESQUIZOFRENIA == "true" | FAMILIA_MADRE_ENFERMEDADES_ESQUIZOFRENIA == "true"),
    family_history_icd9_code3_331 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_ALZHEIMER == "true" | FAMILIA_MADRE_ENFERMEDADES_ALZHEIMER == "true"),
    family_history_icd9_code3_332 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_PARKINSON == "true" | FAMILIA_MADRE_ENFERMEDADES_PARKINSON == "true"),
    family_history_icd9_code3_V83 = ifelse(adopted, NA, FAMILIA_PADRE_ENFERMEDADES_GENETICA_HEREDITARIA == "true" | FAMILIA_MADRE_ENFERMEDADES_GENETICA_HEREDITARIA == "true")
  ) %>% select(
    entity_id,
    adopted,
    multiple_birth,
    family_history_icd9_code3_199,
    family_history_icd9_code3_250,
    family_history_icd9_code3_401,
    family_history_icd9_code3_272,
    family_history_icd9_code3_414,
    family_history_icd9_code3_410,
    family_history_icd9_code3_410,
    family_history_icd9_code3_041,
    family_history_icd9_code3_555,
    family_history_icd9_code3_558,
    family_history_icd9_code3_569,
    family_history_icd9_code3_571,
    family_history_icd9_code3_995,
    family_history_icd9_code3_472,
    family_history_icd9_code3_692,
    family_history_icd9_code3_696,
    family_history_icd9_code3_714,
    family_history_icd9_code3_710,
    family_history_icd9_code3_496,
    family_history_icd9_code3_493,
    family_history_icd9_code3_733,
    family_history_icd9_code3_311,
    family_history_icd9_code3_346,
    family_history_icd9_code3_295,
    family_history_icd9_code3_331,
    family_history_icd9_code3_332,
    family_history_icd9_code3_V83
  )

ds %>% write_csv(sprintf('output/check/%s/data.csv', directory))
